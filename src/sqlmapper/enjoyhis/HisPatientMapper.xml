<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.enjoyhis.persistence.his.dao.HisPatientMapper">
	<resultMap id="BaseResultMap" type="com.enjoyhis.persistence.his.po.HisPatient">
		<!-- WARNING - @mbggenerated This element is automatically generated by MyBatis Generator, do not modify. This element was generated on Wed Aug 17 12:36:52 CST 2016. -->
		<id column="id" property="id" jdbcType="BIGINT" />
		<result column="pat_name" property="patName" jdbcType="VARCHAR" />
		<result column="pym" property="pym" jdbcType="VARCHAR" />
		<result column="unit_code" property="unitCode" jdbcType="INTEGER" />
		<result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
		<result column="modify_time" property="modifyTime" jdbcType="TIMESTAMP" />
		<result column="mobile" property="mobile" jdbcType="VARCHAR" />
		<result column="pat_no" property="patNo" jdbcType="VARCHAR" />
		<result column="user_sex" property="userSex" jdbcType="VARCHAR" />
		<result column="age" property="age" jdbcType="INTEGER" />
		<result column="birthday" property="birthday" jdbcType="DATE" />
		<result column="maindoc_id" property="maindocId" jdbcType="BIGINT" />
		<result column="maindoc_name" property="maindocName" jdbcType="VARCHAR" />
		<result column="account_amount" property="accountAmount" jdbcType="DECIMAL" />
		<result column="original_amount" property="originalAmount" jdbcType="DECIMAL" />
		<result column="given_amount" property="givenAmount" jdbcType="DECIMAL" />
		<result column="debt_amount" property="debtAmount" jdbcType="DECIMAL" />
		<result column="remark" property="remark" jdbcType="VARCHAR" />
		<result column="source" property="source" jdbcType="VARCHAR" />
		<result column="address" property="address" jdbcType="VARCHAR" />
		<result column="newly_ask" property="newlyAsk" jdbcType="VARCHAR" />
		<result column="allergic_his" property="allergicHis" jdbcType="VARCHAR" />
		<result column="newly_date" property="newlyDate" jdbcType="DATE" />
		<result column="visit_times" property="visitTimes" jdbcType="INTEGER" />
		<result column="lastappoint_date" property="lastappointDate" jdbcType="DATE" />
		<result column="lasthosp_date" property="lasthospDate" jdbcType="DATE" />
		<result column="total_spand" property="totalSpand" jdbcType="DECIMAL" />
		<result column="introducer" property="introducer" jdbcType="VARCHAR" />
		<result column="given_coeff" property="givenCoeff" jdbcType="DECIMAL" />
		<result column="tel" property="tel" jdbcType="VARCHAR" />
		<result column="email" property="email" jdbcType="VARCHAR" />
		<result column="persid" property="persid" jdbcType="VARCHAR" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by MyBatis Generator, do not modify. This element was generated on Wed Aug 17 12:36:52 CST 2016. -->
		id, pat_name, pym, unit_code, create_time, modify_time, mobile, pat_no, user_sex,
		age, birthday, maindoc_id, maindoc_name, account_amount, original_amount, given_amount,
		debt_amount, remark, source, address, newly_ask, allergic_his, newly_date, visit_times,
		lastappoint_date, lasthosp_date, total_spand, introducer, given_coeff, tel, email,
		persid
	</sql>
	<select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long">
		<!-- WARNING - @mbggenerated This element is automatically generated by MyBatis Generator, do not modify. This element was generated on Wed Aug 17 12:36:52 CST 2016. -->
		select
		<include refid="Base_Column_List" />
		from his_patient
		where id = #{id,jdbcType=BIGINT}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
		<!-- WARNING - @mbggenerated This element is automatically generated by MyBatis Generator, do not modify. This element was generated on Wed Aug 17 12:36:52 CST 2016. -->
		delete from his_patient
		where id = #{id,jdbcType=BIGINT}
	</delete>
	<insert id="insert" parameterType="com.enjoyhis.persistence.his.po.HisPatient" useGeneratedKeys="true" keyProperty="id">
		<!-- WARNING - @mbggenerated This element is automatically generated by MyBatis Generator, do not modify. This element was generated on Wed Aug 17 12:36:52 CST 2016. -->
		insert into his_patient (id, pat_name, pym,
		unit_code, create_time, modify_time,
		mobile, pat_no, user_sex,
		age, birthday, maindoc_id,
		maindoc_name, account_amount, original_amount,
		given_amount, debt_amount, remark,
		source, address, newly_ask,
		allergic_his, newly_date, visit_times,
		lastappoint_date, lasthosp_date, total_spand,
		introducer, given_coeff, tel,
		email, persid, type)
		values (#{id,jdbcType=BIGINT}, #{patName,jdbcType=VARCHAR}, #{pym,jdbcType=VARCHAR},
		#{unitCode,jdbcType=INTEGER}, #{createTime,jdbcType=TIMESTAMP}, #{modifyTime,jdbcType=TIMESTAMP},
		#{mobile,jdbcType=VARCHAR}, #{patNo,jdbcType=VARCHAR}, #{userSex,jdbcType=VARCHAR},
		#{age,jdbcType=INTEGER}, #{birthday,jdbcType=DATE}, #{maindocId,jdbcType=BIGINT},
		#{maindocName,jdbcType=VARCHAR}, #{accountAmount,jdbcType=DECIMAL}, #{originalAmount,jdbcType=DECIMAL},
		#{givenAmount,jdbcType=DECIMAL}, #{debtAmount,jdbcType=DECIMAL}, #{remark,jdbcType=VARCHAR},
		#{source,jdbcType=VARCHAR}, #{address,jdbcType=VARCHAR}, #{newlyAsk,jdbcType=VARCHAR},
		#{allergicHis,jdbcType=VARCHAR}, #{newlyDate,jdbcType=DATE}, #{visitTimes,jdbcType=INTEGER},
		#{lastappointDate,jdbcType=DATE}, #{lasthospDate,jdbcType=DATE}, #{totalSpand,jdbcType=DECIMAL},
		#{introducer,jdbcType=VARCHAR}, #{givenCoeff,jdbcType=DECIMAL}, #{tel,jdbcType=VARCHAR},
		#{email,jdbcType=VARCHAR}, #{persid,jdbcType=VARCHAR}, #{type,jdbcType=VARCHAR})
	</insert>
	<insert id="insertSelective" parameterType="com.enjoyhis.persistence.his.po.HisPatient" useGeneratedKeys="true" keyProperty="id">
		<!-- WARNING - @mbggenerated This element is automatically generated by MyBatis Generator, do not modify. This element was generated on Wed Aug 17 12:36:52 CST 2016. -->
		insert into his_patient
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="patName != null">
				pat_name,
			</if>
			<if test="pym != null">
				pym,
			</if>
			<if test="unitCode != null">
				unit_code,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
			<if test="modifyTime != null">
				modify_time,
			</if>
			<if test="mobile != null">
				mobile,
			</if>
			<if test="patNo != null">
				pat_no,
			</if>
			<if test="userSex != null">
				user_sex,
			</if>
			<if test="age != null">
				age,
			</if>
			<if test="birthday != null">
				birthday,
			</if>
			<if test="maindocId != null">
				maindoc_id,
			</if>
			<if test="maindocName != null">
				maindoc_name,
			</if>
			<if test="accountAmount != null">
				account_amount,
			</if>
			<if test="originalAmount != null">
				original_amount,
			</if>
			<if test="givenAmount != null">
				given_amount,
			</if>
			<if test="debtAmount != null">
				debt_amount,
			</if>
			<if test="remark != null">
				remark,
			</if>
			<if test="source != null">
				source,
			</if>
			<if test="address != null">
				address,
			</if>
			<if test="newlyAsk != null">
				newly_ask,
			</if>
			<if test="allergicHis != null">
				allergic_his,
			</if>
			<if test="newlyDate != null">
				newly_date,
			</if>
			<if test="visitTimes != null">
				visit_times,
			</if>
			<if test="lastappointDate != null">
				lastappoint_date,
			</if>
			<if test="lasthospDate != null">
				lasthosp_date,
			</if>
			<if test="totalSpand != null">
				total_spand,
			</if>
			<if test="introducer != null">
				introducer,
			</if>
			<if test="givenCoeff != null">
				given_coeff,
			</if>
			<if test="tel != null">
				tel,
			</if>
			<if test="email != null">
				email,
			</if>
			<if test="persid != null">
				persid,
			</if>
			<if test="type!= null">
				type,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=BIGINT},
			</if>
			<if test="patName != null">
				#{patName,jdbcType=VARCHAR},
			</if>
			<if test="pym != null">
				#{pym,jdbcType=VARCHAR},
			</if>
			<if test="unitCode != null">
				#{unitCode,jdbcType=INTEGER},
			</if>
			<if test="createTime != null">
				#{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="modifyTime != null">
				#{modifyTime,jdbcType=TIMESTAMP},
			</if>
			<if test="mobile != null">
				#{mobile,jdbcType=VARCHAR},
			</if>
			<if test="patNo != null">
				#{patNo,jdbcType=VARCHAR},
			</if>
			<if test="userSex != null">
				#{userSex,jdbcType=VARCHAR},
			</if>
			<if test="age != null">
				#{age,jdbcType=INTEGER},
			</if>
			<if test="birthday != null">
				#{birthday,jdbcType=DATE},
			</if>
			<if test="maindocId != null">
				#{maindocId,jdbcType=BIGINT},
			</if>
			<if test="maindocName != null">
				#{maindocName,jdbcType=VARCHAR},
			</if>
			<if test="accountAmount != null">
				#{accountAmount,jdbcType=DECIMAL},
			</if>
			<if test="originalAmount != null">
				#{originalAmount,jdbcType=DECIMAL},
			</if>
			<if test="givenAmount != null">
				#{givenAmount,jdbcType=DECIMAL},
			</if>
			<if test="debtAmount != null">
				#{debtAmount,jdbcType=DECIMAL},
			</if>
			<if test="remark != null">
				#{remark,jdbcType=VARCHAR},
			</if>
			<if test="source != null">
				#{source,jdbcType=VARCHAR},
			</if>
			<if test="address != null">
				#{address,jdbcType=VARCHAR},
			</if>
			<if test="newlyAsk != null">
				#{newlyAsk,jdbcType=VARCHAR},
			</if>
			<if test="allergicHis != null">
				#{allergicHis,jdbcType=VARCHAR},
			</if>
			<if test="newlyDate != null">
				#{newlyDate,jdbcType=DATE},
			</if>
			<if test="visitTimes != null">
				#{visitTimes,jdbcType=INTEGER},
			</if>
			<if test="lastappointDate != null">
				#{lastappointDate,jdbcType=DATE},
			</if>
			<if test="lasthospDate != null">
				#{lasthospDate,jdbcType=DATE},
			</if>
			<if test="totalSpand != null">
				#{totalSpand,jdbcType=DECIMAL},
			</if>
			<if test="introducer != null">
				#{introducer,jdbcType=VARCHAR},
			</if>
			<if test="givenCoeff != null">
				#{givenCoeff,jdbcType=DECIMAL},
			</if>
			<if test="tel != null">
				#{tel,jdbcType=VARCHAR},
			</if>
			<if test="email != null">
				#{email,jdbcType=VARCHAR},
			</if>
			<if test="persid != null">
				#{persid,jdbcType=VARCHAR},
			</if>
			<if test="type!= null">
				#{type,jdbcType=VARCHAR},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.enjoyhis.persistence.his.po.HisPatient">
		<!-- WARNING - @mbggenerated This element is automatically generated by MyBatis Generator, do not modify. This element was generated on Wed Aug 17 12:36:52 CST 2016. -->
		update his_patient
		<set>
			<if test="patName != null">
				pat_name = #{patName,jdbcType=VARCHAR},
			</if>
			<if test="pym != null">
				pym = #{pym,jdbcType=VARCHAR},
			</if>
			<if test="unitCode != null">
				unit_code = #{unitCode,jdbcType=INTEGER},
			</if>
			<if test="createTime != null">
				create_time = #{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="modifyTime != null">
				modify_time = #{modifyTime,jdbcType=TIMESTAMP},
			</if>
			<if test="mobile != null">
				mobile = #{mobile,jdbcType=VARCHAR},
			</if>
			<if test="patNo != null">
				pat_no = #{patNo,jdbcType=VARCHAR},
			</if>
			<if test="userSex != null">
				user_sex = #{userSex,jdbcType=VARCHAR},
			</if>
			<if test="age != null">
				age = #{age,jdbcType=INTEGER},
			</if>
			<if test="birthday != null">
				birthday = #{birthday,jdbcType=DATE},
			</if>
			<if test="maindocId != null">
				maindoc_id = #{maindocId,jdbcType=BIGINT},
			</if>
			<if test="maindocName != null">
				maindoc_name = #{maindocName,jdbcType=VARCHAR},
			</if>
			<if test="accountAmount != null">
				account_amount = #{accountAmount,jdbcType=DECIMAL},
			</if>
			<if test="originalAmount != null">
				original_amount = #{originalAmount,jdbcType=DECIMAL},
			</if>
			<if test="givenAmount != null">
				given_amount = #{givenAmount,jdbcType=DECIMAL},
			</if>
			<if test="debtAmount != null">
				debt_amount = #{debtAmount,jdbcType=DECIMAL},
			</if>
			<if test="remark != null">
				remark = #{remark,jdbcType=VARCHAR},
			</if>
			<if test="source != null">
				source = #{source,jdbcType=VARCHAR},
			</if>
			<if test="address != null">
				address = #{address,jdbcType=VARCHAR},
			</if>
			<if test="newlyAsk != null">
				newly_ask = #{newlyAsk,jdbcType=VARCHAR},
			</if>
			<if test="allergicHis != null">
				allergic_his = #{allergicHis,jdbcType=VARCHAR},
			</if>
			<if test="newlyDate != null">
				newly_date = #{newlyDate,jdbcType=DATE},
			</if>
			<if test="visitTimes != null">
				visit_times = #{visitTimes,jdbcType=INTEGER},
			</if>
			<if test="lastappointDate != null">
				lastappoint_date = #{lastappointDate,jdbcType=DATE},
			</if>
			<if test="lasthospDate != null">
				lasthosp_date = #{lasthospDate,jdbcType=DATE},
			</if>
			<if test="totalSpand != null">
				total_spand = #{totalSpand,jdbcType=DECIMAL},
			</if>
			<if test="introducer != null">
				introducer = #{introducer,jdbcType=VARCHAR},
			</if>
			<if test="givenCoeff != null">
				given_coeff = #{givenCoeff,jdbcType=DECIMAL},
			</if>
			<if test="tel != null">
				tel = #{tel,jdbcType=VARCHAR},
			</if>
			<if test="email != null">
				email = #{email,jdbcType=VARCHAR},
			</if>
			<if test="persid != null">
				persid = #{persid,jdbcType=VARCHAR},
			</if>
			<if test="type != null">
				type = #{type,jdbcType=VARCHAR},
			</if>
		</set>
		where id = #{id,jdbcType=BIGINT}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.enjoyhis.persistence.his.po.HisPatient">
		<!-- WARNING - @mbggenerated This element is automatically generated by MyBatis Generator, do not modify. This element was generated on Wed Aug 17 12:36:52 CST 2016. -->
		update his_patient
		set pat_name = #{patName,jdbcType=VARCHAR},
		pym = #{pym,jdbcType=VARCHAR},
		unit_code = #{unitCode,jdbcType=INTEGER},
		create_time = #{createTime,jdbcType=TIMESTAMP},
		modify_time = #{modifyTime,jdbcType=TIMESTAMP},
		mobile = #{mobile,jdbcType=VARCHAR},
		pat_no = #{patNo,jdbcType=VARCHAR},
		user_sex = #{userSex,jdbcType=VARCHAR},
		age = #{age,jdbcType=INTEGER},
		birthday = #{birthday,jdbcType=DATE},
		maindoc_id = #{maindocId,jdbcType=BIGINT},
		maindoc_name = #{maindocName,jdbcType=VARCHAR},
		account_amount = #{accountAmount,jdbcType=DECIMAL},
		original_amount = #{originalAmount,jdbcType=DECIMAL},
		given_amount = #{givenAmount,jdbcType=DECIMAL},
		debt_amount = #{debtAmount,jdbcType=DECIMAL},
		remark = #{remark,jdbcType=VARCHAR},
		source = #{source,jdbcType=VARCHAR},
		address = #{address,jdbcType=VARCHAR},
		newly_ask = #{newlyAsk,jdbcType=VARCHAR},
		allergic_his = #{allergicHis,jdbcType=VARCHAR},
		newly_date = #{newlyDate,jdbcType=DATE},
		visit_times = #{visitTimes,jdbcType=INTEGER},
		lastappoint_date = #{lastappointDate,jdbcType=DATE},
		lasthosp_date = #{lasthospDate,jdbcType=DATE},
		total_spand = #{totalSpand,jdbcType=DECIMAL},
		introducer = #{introducer,jdbcType=VARCHAR},
		given_coeff = #{givenCoeff,jdbcType=DECIMAL},
		tel = #{tel,jdbcType=VARCHAR},
		email = #{email,jdbcType=VARCHAR},
		type = #{type,jdbcType=VARCHAR},
		persid = #{persid,jdbcType=VARCHAR}
		where id = #{id,jdbcType=BIGINT}
	</update>
	<!-- addtional: insert add tag: useGeneratedKeys="true" keyProperty="id" then add follows: -->
	<sql id="Where_Clause">
		<where>
			<if test="id != null">
				and id = #{id,jdbcType=BIGINT}
			</if>
			<if test="patName != null">
				and pat_name = #{patName,jdbcType=VARCHAR}
			</if>
			<if test="pym != null">
				and pym = #{pym,jdbcType=VARCHAR}
			</if>
			<if test="unitCode != null">
				and unit_code = #{unitCode,jdbcType=INTEGER}
			</if>
			<if test="createTime != null">
				and create_time = #{createTime,jdbcType=TIMESTAMP}
			</if>
			<if test="modifyTime != null">
				and modify_time = #{modifyTime,jdbcType=TIMESTAMP}
			</if>
			<if test="mobile != null">
				and mobile = #{mobile,jdbcType=VARCHAR}
			</if>
			<if test="patNo != null">
				and pat_no = #{patNo,jdbcType=VARCHAR}
			</if>
			<if test="userSex != null">
				and user_sex = #{userSex,jdbcType=VARCHAR}
			</if>
			<if test="age != null">
				and age = #{age,jdbcType=INTEGER}
			</if>
			<if test="birthday != null">
				and birthday = #{birthday,jdbcType=DATE}
			</if>
			<if test="maindocId != null">
				and maindoc_id = #{maindocId,jdbcType=BIGINT}
			</if>
			<if test="maindocName != null">
				and maindoc_name = #{maindocName,jdbcType=VARCHAR}
			</if>
			<if test="accountAmount != null">
				and account_amount = #{accountAmount,jdbcType=DECIMAL}
			</if>
			<if test="originalAmount != null">
				and original_amount = #{originalAmount,jdbcType=DECIMAL}
			</if>
			<if test="givenAmount != null">
				and given_amount = #{givenAmount,jdbcType=DECIMAL}
			</if>
			<if test="debtAmount != null">
				and debt_amount = #{debtAmount,jdbcType=DECIMAL}
			</if>
			<if test="remark != null">
				and remark = #{remark,jdbcType=VARCHAR}
			</if>
			<if test="source != null">
				and source = #{source,jdbcType=VARCHAR}
			</if>
			<if test="address != null">
				and address = #{address,jdbcType=VARCHAR}
			</if>
			<if test="newlyAsk != null">
				and newly_ask = #{newlyAsk,jdbcType=VARCHAR}
			</if>
			<if test="allergicHis != null">
				and allergic_his = #{allergicHis,jdbcType=VARCHAR}
			</if>
			<if test="newlyDate != null">
				and newly_date = #{newlyDate,jdbcType=DATE}
			</if>
			<if test="visitTimes != null">
				and visit_times = #{visitTimes,jdbcType=INTEGER}
			</if>
			<if test="lastappointDate != null">
				and lastappoint_date = #{lastappointDate,jdbcType=DATE}
			</if>
			<if test="lasthospDate != null">
				and lasthosp_date = #{lasthospDate,jdbcType=DATE}
			</if>
			<if test="totalSpand != null">
				and total_spand = #{totalSpand,jdbcType=DECIMAL}
			</if>
			<if test="introducer != null">
				and introducer = #{introducer,jdbcType=VARCHAR}
			</if>
			<if test="givenCoeff != null">
				and given_coeff = #{givenCoeff,jdbcType=DECIMAL}
			</if>
			<if test="tel != null">
				and tel = #{tel,jdbcType=VARCHAR}
			</if>
			<if test="email != null">
				and email = #{email,jdbcType=VARCHAR}
			</if>
			<if test="persid != null">
				and persid = #{persid,jdbcType=VARCHAR}
			</if>
			<if test="sqlStr !=null">
				${sqlStr}
			</if>
		</where>
	</sql>

	<sql id="OrderBy_Clause">
		<if test="sqlSort != null">
			order by ${sqlSort}
		</if>
	</sql>

	<sql id="Limit_Clause">
		<if test="limitStart != null and limitCount != null">
			limit ${limitStart}, ${limitCount}
		</if>
	</sql>

	<select id="selectOne" resultMap="BaseResultMap" parameterType="com.enjoyhis.persistence.his.po.HisPatient">
		select
		<include refid="Base_Column_List" />
		from his_patient
		<include refid="Where_Clause" />
	</select>

	<select id="selectList" resultMap="BaseResultMap" parameterType="com.enjoyhis.persistence.his.po.HisPatient">
		select
		<include refid="Base_Column_List" />
		from his_patient
		<include refid="Where_Clause" />
		<include refid="OrderBy_Clause" />
		<include refid="Limit_Clause" />
	</select>

	<select id="selectCount" resultType="java.lang.Integer" parameterType="com.enjoyhis.persistence.his.po.HisPatient">
		select count(id) from his_patient
		<include refid="Where_Clause" />
	</select>

	<delete id="deleteSelective" parameterType="com.enjoyhis.persistence.his.po.HisPatient">
		delete from his_patient
		<include refid="Where_Clause" />
	</delete>

	<!-- 条件查询分页数据 -->
	<select id="page4List" parameterType="map" resultType="map">
		SELECT DISTINCT
		a.id as id,
		a.pat_name as patName,
		a.pat_no as patNo,
		a.maindoc_id as maindocId,
		a.maindoc_name as maindocName,
		a.user_sex as userSex,
		a.age as age,
		DATE_FORMAT(a.birthday,'%Y-%m-%d') as birthday,
		a.mobile as mobile,
		a.debt_amount as debtAmount,
		a.allergic_his as allergicHis,
		a.source as source,
		a.account_amount as accountAmount,
		a.address as address,
		a.newly_ask as newlyAsk,
		a.allergic_his as allergicHis,
		a.introducer as introducer,
		a.tel as tel,
		a.email as email,
		a.persid as persid,
		a.remark
		FROM his_patient a
		JOIN his_register b ON a.id = b.pat_id
		<where>
			<if test="docId!=null and docId!=''">
				and b.dentist_id = ${docId}
			</if>
			<if test="mobile!=null and mobile!=''">
				and a.mobile like CONCAT(#{mobile},"%")
			</if>
			<if test="name!=null and name!=''">
				and (a.pat_name like CONCAT(#{name},"%") or a.pym like CONCAT(#{name},"%"))
			</if>
		</where>
		<if test="null!=limitStart and null!=limitCount">
			limit ${limitStart}, ${limitCount}
		</if>
	</select>
	<!-- 条件查询分页总记录数 -->
	<select id="page4Count" parameterType="map" resultType="Integer">
		SELECT
		COUNT(DISTINCT a.id)
		FROM his_patient a
		JOIN his_register b ON a.id = b.pat_id
		<where>
			<if test="docId!=null and docId!=''">
				and b.dentist_id = ${docId}
			</if>
			<if test="name!=null and name!=''">
				and (a.pat_name like CONCAT(#{name},"%") or a.pym like CONCAT(#{name},"%"))
			</if>
			<if test="mobile!=null and mobile!=''">
				and a.mobile like CONCAT(#{mobile},"%")
			</if>
		</where>
	</select>
	
	<!-- 条件查询分页数据 -->
	<select id="patientPage4List" parameterType="map" resultType="map">
		SELECT
		a.id as id,
		a.pat_name as patName,
		a.pat_no as patNo,
		a.maindoc_id as maindocId,
		a.maindoc_name as maindocName,
		a.user_sex as userSex,
		a.age as age,
		DATE_FORMAT(a.birthday,'%Y-%m-%d') as birthday,
		a.mobile as mobile,
		a.debt_amount as debtAmount,
		a.allergic_his as allergicHis,
		a.source as source,
		a.account_amount as accountAmount,
		a.address as address,
		a.newly_ask as newlyAsk,
		a.allergic_his as allergicHis,
		a.introducer as introducer,
		a.tel as tel,
		a.email as email,
		a.persid as persid,
		a.remark
		FROM his_patient a
		<where>
			<if test="docId!=null and docId!=''">
				and a.id in(select pat_id from his_register b where b.dentist_id=#{docId} group by b.pat_id)
			</if>
			<if test="mobile!=null and mobile!=''">
				and a.mobile like CONCAT(#{mobile},"%")
			</if>
			<if test="name!=null and name!=''">
				and (a.pat_name like CONCAT(#{name},"%") or a.pym like CONCAT(#{name},"%"))
			</if>
		</where>
		<if test="null!=limitStart and null!=limitCount">
			limit ${limitStart}, ${limitCount}
		</if>
	</select>
	<!-- 条件查询分页总记录数 -->
	<select id="patientPage4Count" parameterType="map" resultType="Integer">
		SELECT
		count(a.id)
		FROM his_patient a
		<where>
			<if test="docId!=null and docId!=''">
				and a.id in(select pat_id from his_register b where b.dentist_id=#{docId})
			</if>
			<if test="mobile!=null and mobile!=''">
				and a.mobile like CONCAT(#{mobile},"%")
			</if>
			<if test="name!=null and name!=''">
				and (a.pat_name like CONCAT(#{name},"%") or a.pym like CONCAT(#{name},"%"))
			</if>
		</where>
	</select>

</mapper>